# 기술 요구 사항 문서 (TRD)

## 1. 기술 요약
- **프로젝트 개요**: BookCraft는 아이들의 독서 습관 형성을 돕는 게임화된 웹 MVP입니다. Next.js 15 기반의 반응형 웹으로 개발되며, Supabase를 활용하여 데이터 관리 및 인증을 처리합니다. Google Gemini API 또는 OpenAI를 이용하여 음성 요약 및 AI 칭찬 기능을 제공합니다.
- **핵심 기술 스택**: Next.js 15, Typescript, TailwindCSS, shadcn, lucide-react, Supabase(PostgreSQL & Auth & Realtime), @tanstack/react-query, Google Gemini API, OpenAI, es-toolkit, date-fns, Pusher (fallback), Stripe
- **주요 기술 목표**:
    - 높은 몰입도를 위한 빠른 응답 속도 및 부드러운 UX 제공
    - 확장 가능한 아키텍처를 통해 사용자 증가에 유연하게 대응
    - 데이터 보안 및 개인 정보 보호 강화
- **주요 기술 가정**:
    - Supabase 무료 티어가 초기 사용자 규모를 충족할 수 있다고 가정
    - Google Gemini API 또는 OpenAI의 API 사용량은 초기 예산 내에서 관리 가능하다고 가정
    - 사용자들은 최신 브라우저를 사용한다고 가정

## 2. 기술 스택

| 카테고리          | 기술 / 라이브러리        | 이유 (프로젝트에 선택된 이유)                                                                                                                                                                                                                                                                                                                                                                |
| ----------------- | --------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 프레임워크        | Next.js 15                | 서버 사이드 렌더링(SSR), 정적 사이트 생성(SSG) 및 API 라우팅을 지원하여 초기 로딩 속도 개선 및 SEO 최적화. React 기반으로 컴포넌트 재사용성 및 개발 생산성 향상.                                                                                                                                                                                                                         |
| 언어              | Typescript                | 정적 타입 시스템을 통해 코드 안정성 및 유지보수성 향상. 개발 단계에서 오류를 사전에 발견하여 런타임 오류 감소.                                                                                                                                                                                                                                                                                     |
| 스타일링          | TailwindCSS               | 유틸리티 우선 CSS 프레임워크로 빠른 스타일링 및 일관성 유지. 컴포넌트 기반 디자인 시스템 구축 용이.                                                                                                                                                                                                                                                                                                |
| UI 컴포넌트       | shadcn                    | 재사용 가능한 UI 컴포넌트 제공으로 개발 속도 향상 및 디자인 일관성 유지. 접근성(Accessibility)을 고려한 컴포넌트 제공.                                                                                                                                                                                                                                                                           |
| 아이콘            | lucide-react              | 고품질의 벡터 아이콘 제공으로 UI 완성도 향상. React 컴포넌트 형태로 사용 용이.                                                                                                                                                                                                                                                                                                                      |
| 데이터베이스      | Supabase(PostgreSQL)       | PostgreSQL 기반의 클라우드 데이터베이스로 안정성 및 확장성 확보. 실시간 데이터 동기화를 위한 Realtime 기능 제공.                                                                                                                                                                                                                                                                                      |
| 인증              | Supabase Auth             | 간편한 인증 시스템 구축 및 관리. 소셜 로그인, 이메일/비밀번호 인증 등 다양한 인증 방식 지원.                                                                                                                                                                                                                                                                                                             |
| 상태 관리         | @tanstack/react-query      | 서버 상태 관리 라이브러리로 데이터 fetching, 캐싱, 업데이트를 효율적으로 관리. 코드 간결성 및 성능 최적화.                                                                                                                                                                                                                                                                                          |
| AI (음성 요약, 칭찬) | Google Gemini API / OpenAI | 음성 요약 및 AI 칭찬 기능 제공. 서버리스 edge 함수를 통해 API 호출 및 응답 속도 최적화.                                                                                                                                                                                                                                                                                                           |
| 유틸리티          | es-toolkit                | 유용한 유틸리티 함수 제공으로 개발 편의성 향상.                                                                                                                                                                                                                                                                                                                                                         |
| 날짜 포맷         | date-fns                  | 강력한 날짜 포맷팅 및 조작 기능 제공.                                                                                                                                                                                                                                                                                                                                                                 |
| 실시간 통신       | Pusher (fallback)          | 실시간 랭킹 및 업데이트를 위한 WebSocket 기반 통신. 안정적인 연결을 위한 fallback 메커니즘 제공.                                                                                                                                                                                                                                                                                                        |
| 결제              | Stripe                    | (향후 확장 고려) 안전하고 간편한 결제 시스템 구축.                                                                                                                                                                                                                                                                                                                                                     |

## 3. 시스템 아키텍처 설계

### 최상위 빌딩 블록
- **Frontend (Next.js)**: 사용자 인터페이스 및 사용자 경험을 담당합니다.
    - 하위 빌딩 블록:
        - 컴포넌트 (UI 요소)
        - 페이지 (라우팅)
        - API 라우트 (프론트엔드 API)
        - 상태 관리 (React Query)
- **Backend (Supabase)**: 데이터 저장, 인증, 실시간 데이터 동기화를 담당합니다.
    - 하위 빌딩 블록:
        - PostgreSQL 데이터베이스
        - Supabase Auth (인증)
        - Supabase Realtime (실시간 데이터)
        - 서버리스 함수 (AI API 호출)
- **AI Service (Google Gemini API / OpenAI)**: 음성 요약 및 AI 칭찬 기능을 제공합니다.
    - 하위 빌딩 블록:
        - 음성 인식 API
        - 자연어 처리 API
        - 칭찬 생성 로직

### 최상위 컴포넌트 상호 작용 다이어그램

```mermaid
graph TD
    A[Frontend (Next.js)] --> B[Backend (Supabase)]
    B --> C[PostgreSQL]
    B --> D[AI Service (Gemini/OpenAI)]
    A --> D
```

- **Frontend (Next.js)**: 사용자의 요청을 받아 Backend (Supabase)에 API 요청을 보냅니다. 또한 AI Service (Gemini/OpenAI)에 직접 요청을 보내 음성 요약 및 칭찬 기능을 사용합니다.
- **Backend (Supabase)**: Frontend의 요청을 받아 PostgreSQL 데이터베이스에 데이터를 저장하거나 조회합니다. Supabase Auth를 통해 사용자 인증을 처리합니다.
- **PostgreSQL**: 사용자 데이터, 책 데이터, 퀘스트 데이터 등 모든 데이터를 저장합니다.
- **AI Service (Gemini/OpenAI)**: 음성 요약 및 AI 칭찬 기능을 제공합니다. Frontend 또는 Backend의 요청을 받아 결과를 반환합니다.

### 코드 조직 및 규칙

**도메인 기반 조직 전략**
- **도메인 분리**: 사용자 관리, 책 관리, 퀘스트 관리, 보상 관리 등 비즈니스 도메인별로 코드를 분리합니다.
- **계층 기반 아키텍처**: 프레젠테이션(UI), 비즈니스 로직, 데이터 액세스, 인프라스트럭처 계층으로 분리합니다.
- **기능 기반 모듈**: 관련된 기능들을 함께 그룹화합니다. (예: 책 등록 기능은 책 등록 UI, 책 등록 API, 책 등록 로직을 함께 묶음)
- **공유 컴포넌트**: 공통 유틸리티, 타입, 재사용 가능한 컴포넌트를 별도의 모듈에 저장합니다.

**범용 파일 & 폴더 구조**
```
/
├── components/             # 재사용 가능한 UI 컴포넌트
│   ├── BookCard.tsx        # 책 카드 컴포넌트
│   ├── QuestItem.tsx       # 퀘스트 아이템 컴포넌트
│   └── ...
├── pages/                  # Next.js 페이지
│   ├── index.tsx           # 메인 페이지
│   ├── books/              # 책 관련 페이지
│   │   ├── [id].tsx        # 책 상세 페이지
│   │   └── add.tsx         # 책 등록 페이지
│   ├── quests/             # 퀘스트 관련 페이지
│   │   └── ...
│   └── ...
├── services/               # API 요청 및 비즈니스 로직
│   ├── bookService.ts      # 책 관련 API 요청
│   ├── questService.ts     # 퀘스트 관련 API 요청
│   └── ...
├── utils/                  # 유틸리티 함수
│   ├── dateUtils.ts        # 날짜 관련 유틸리티
│   ├── formatUtils.ts      # 포맷 관련 유틸리티
│   └── ...
├── types/                  # 타입 정의
│   ├── Book.ts             # 책 타입 정의
│   ├── Quest.ts            # 퀘스트 타입 정의
│   └── ...
├── public/                 # 정적 파일
│   ├── images/             # 이미지
│   ├── fonts/              # 폰트
│   └── ...
├── tailwind.config.js      # TailwindCSS 설정 파일
├── tsconfig.json           # Typescript 설정 파일
└── ...
```

### 데이터 흐름 및 통신 패턴
- **클라이언트-서버 통신**: API 요청/응답 패턴 (RESTful API)
- **데이터베이스 상호 작용**: Supabase ORM을 사용하여 데이터베이스와 상호 작용
- **외부 서비스 통합**: Google Gemini API / OpenAI API를 사용하여 음성 요약 및 AI 칭찬 기능 통합
- **실시간 통신**: Pusher를 사용하여 실시간 랭킹 및 업데이트 구현
- **데이터 동기화**: Supabase Realtime을 사용하여 데이터 동기화

## 4. 성능 & 최적화 전략

- **코드 분할**: Next.js의 코드 분할 기능을 활용하여 초기 로딩 속도 최적화
- **이미지 최적화**: 이미지 크기 최적화 및 lazy loading 적용
- **캐싱**: @tanstack/react-query를 사용하여 API 응답 캐싱
- **데이터베이스 쿼리 최적화**: 적절한 인덱스 생성 및 쿼리 튜닝

## 5. 구현 로드맵 & 마일스톤

### 1단계: 기반 (MVP 구현)
- **핵심 인프라**: 기본 시스템 설정 및 기반 컴포넌트 구현
- **필수 기능**: 책 등록, 퀘스트 생성/트래킹, XP/코인 로직 구현
- **기본 보안**: 기본적인 인증 및 권한 관리 구현
- **개발 환경**: 개발 환경 설정 및 CI/CD 기본 설정
- **타임라인**: 1주차 ~ 3주차

### 2단계: 기능 개선
- **고급 기능**: 음성 요약 & AI 칭찬, 아바타 꾸미기, 가족 챌린지/랭킹, 주간 리포트 구현
- **성능 최적화**: 시스템 성능 개선 및 최적화
- **보안 강화**: 보안 기능 강화 및 개인 정보 보호 강화
- **모니터링 구현**: 시스템 모니터링 및 로깅 설정
- **타임라인**: 4주차 ~ 6주차

## 6. 위험 평가 & 완화 전략

### 기술적 위험 분석
- **기술 위험**: AI 서비스 통합의 복잡성 및 예상치 못한 기술적 문제 발생 가능성
- **성능 위험**: 사용자 증가에 따른 시스템 확장성 문제 및 성능 저하 가능성
- **보안 위험**: 아동 개인 정보 유출 및 보안 취약점 발생 가능성
- **통합 위험**: 외부 API 서비스의 불안정성 및 의존성 문제 발생 가능성
- **완화 전략**:
    - AI 서비스 통합 전에 충분한 테스트 및 검증 수행
    - 시스템 확장성을 고려한 아키텍처 설계 및 성능 모니터링
    - 개인 정보 보호를 위한 보안 정책 수립 및 기술적 조치 강화
    - 외부 API 서비스에 대한 의존성을 줄이고 대체 방안 마련

### 프로젝트 전달 위험
- **타임라인 위험**: 개발 일정 지연 및 기능 구현 차질 가능성
- **리소스 위험**: 개발 인력 부족 및 기술 전문성 부족 가능성
- **품질 위험**: 코드 품질 저하 및 테스트 부족으로 인한 버그 발생 가능성
- **배포 위험**: 프로덕션 배포 시 예상치 못한 문제 발생 가능성
- **대응 계획**:
    - 현실적인 개발 일정 수립 및 주기적인 진척 상황 점검
    - 충분한 개발 인력 확보 및 기술 교육 지원
    - 코드 리뷰 및 충분한 테스트를 통해 코드 품질 확보
    - 배포 전에 충분한 테스트 환경 구축 및 배포 절차 검증
